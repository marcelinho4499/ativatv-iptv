<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="theme-color" content="#0a0a0f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="AtivaTV">
<title>AtivaTV</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
:root {
  --red: #e01c2e;
  --red-dark: #b01525;
  --blue: #1a4fd6;
  --blue-light: #2d6fff;
  --bg: #0a0a0f;
  --bg2: #111118;
  --bg3: #18181f;
  --bg4: #1e1e28;
  --border: rgba(255,255,255,0.07);
  --text: #f0f0f8;
  --text2: #9090a8;
  --font-display: 'Rajdhani', sans-serif;
  --font-body: 'Exo 2', sans-serif;
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ===== SCREENS ===== */
.screen { display:none; min-height:100vh; }
.screen.active { display:flex; flex-direction:column; }

/* ===== LOGIN SCREEN ===== */
#screen-login {
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

.login-bg {
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at 30% 20%, rgba(26,79,214,0.15) 0%, transparent 60%),
              radial-gradient(ellipse at 70% 80%, rgba(224,28,46,0.12) 0%, transparent 60%),
              var(--bg);
}

.login-grid {
  position: absolute;
  inset: 0;
  background-image: linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
  background-size: 40px 40px;
}

.login-card {
  position: relative;
  z-index: 1;
  width: 100%;
  max-width: 420px;
  padding: 20px;
}

.login-logo {
  text-align: center;
  margin-bottom: 32px;
}

.login-logo img {
  width: 100px;
  height: 100px;
  object-fit: contain;
  filter: drop-shadow(0 0 20px rgba(224,28,46,0.4));
  animation: logoPulse 3s ease-in-out infinite;
}

@keyframes logoPulse {
  0%, 100% { filter: drop-shadow(0 0 20px rgba(224,28,46,0.4)); }
  50% { filter: drop-shadow(0 0 35px rgba(26,79,214,0.5)); }
}

.login-logo h1 {
  font-family: var(--font-display);
  font-size: 2.4rem;
  font-weight: 700;
  letter-spacing: 4px;
  margin-top: 8px;
  background: linear-gradient(135deg, var(--red), var(--blue-light));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.login-logo p {
  font-size: 0.75rem;
  color: var(--text2);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-top: 2px;
}

.login-form {
  background: rgba(255,255,255,0.03);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 28px;
  backdrop-filter: blur(10px);
}

.form-group {
  margin-bottom: 16px;
}

.form-group label {
  display: block;
  font-size: 0.7rem;
  color: var(--text2);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 6px;
}

.form-group input {
  width: 100%;
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 14px;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 0.95rem;
  transition: border-color 0.2s, background 0.2s;
  outline: none;
}

.form-group input:focus {
  border-color: var(--blue-light);
  background: rgba(45,111,255,0.08);
}

.form-group input::placeholder { color: var(--text2); }

.btn-login {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, var(--red), var(--blue));
  border: none;
  border-radius: 8px;
  color: #fff;
  font-family: var(--font-display);
  font-size: 1.1rem;
  font-weight: 700;
  letter-spacing: 3px;
  cursor: pointer;
  margin-top: 8px;
  transition: opacity 0.2s, transform 0.1s;
  position: relative;
  overflow: hidden;
}

.btn-login::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.15), transparent);
  opacity: 0;
  transition: opacity 0.2s;
}

.btn-login:hover::after { opacity: 1; }
.btn-login:active { transform: scale(0.98); }

.login-error {
  background: rgba(224,28,46,0.15);
  border: 1px solid rgba(224,28,46,0.3);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 0.85rem;
  color: #ff6b7a;
  margin-top: 12px;
  display: none;
  text-align: center;
}

/* ===== HEADER ===== */
.header {
  background: linear-gradient(180deg, rgba(10,10,15,0.98) 0%, rgba(10,10,15,0.85) 100%);
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(12px);
}

.header-logo {
  display: flex;
  align-items: center;
  gap: 10px;
}

.header-logo img {
  width: 36px;
  height: 36px;
  object-fit: contain;
}

.header-logo span {
  font-family: var(--font-display);
  font-size: 1.4rem;
  font-weight: 700;
  letter-spacing: 2px;
  background: linear-gradient(135deg, var(--red), var(--blue-light));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.btn-icon {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  border: 1px solid var(--border);
  background: var(--bg3);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s;
  font-size: 1rem;
}

.btn-icon:hover { background: var(--bg4); border-color: rgba(255,255,255,0.15); }

/* ===== NAV TABS ===== */
.nav-tabs {
  display: flex;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  overflow-x: auto;
  scrollbar-width: none;
}

.nav-tabs::-webkit-scrollbar { display: none; }

.nav-tab {
  flex: 1;
  min-width: 80px;
  padding: 14px 8px;
  text-align: center;
  cursor: pointer;
  font-family: var(--font-display);
  font-size: 0.8rem;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--text2);
  border-bottom: 2px solid transparent;
  transition: color 0.2s, border-color 0.2s;
  white-space: nowrap;
}

.nav-tab .tab-icon { font-size: 1.2rem; display: block; margin-bottom: 3px; }
.nav-tab.active { color: var(--text); border-bottom-color: var(--red); }

/* ===== CONTENT AREA ===== */
.content {
  flex: 1;
  overflow-y: auto;
  padding-bottom: 20px;
}

/* ===== HOME SCREEN ===== */
.home-hero {
  position: relative;
  height: 180px;
  overflow: hidden;
  margin-bottom: 24px;
}

.home-hero-bg {
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(224,28,46,0.3) 0%, rgba(26,79,214,0.3) 100%);
}

.home-hero-content {
  position: absolute;
  bottom: 20px;
  left: 20px;
}

.home-hero-content h2 {
  font-family: var(--font-display);
  font-size: 1.8rem;
  font-weight: 700;
  letter-spacing: 2px;
}

.home-hero-content p { color: var(--text2); font-size: 0.85rem; margin-top: 4px; }

.home-cards {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  padding: 0 16px 24px;
}

.home-card {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 22px 16px;
  text-align: center;
  cursor: pointer;
  transition: transform 0.2s, border-color 0.2s, background 0.2s;
  position: relative;
  overflow: hidden;
}

.home-card::before {
  content: '';
  position: absolute;
  inset: 0;
  opacity: 0;
  transition: opacity 0.2s;
}

.home-card.card-tv::before { background: radial-gradient(circle at 50% 0%, rgba(224,28,46,0.15), transparent 70%); }
.home-card.card-filmes::before { background: radial-gradient(circle at 50% 0%, rgba(26,79,214,0.15), transparent 70%); }
.home-card.card-series::before { background: radial-gradient(circle at 50% 0%, rgba(45,111,255,0.15), transparent 70%); }
.home-card.card-ajustes::before { background: radial-gradient(circle at 50% 0%, rgba(144,144,168,0.1), transparent 70%); }

.home-card:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.15); }
.home-card:hover::before { opacity: 1; }
.home-card:active { transform: scale(0.97); }

.home-card .card-icon {
  font-size: 2.2rem;
  margin-bottom: 10px;
  display: block;
}

.home-card h3 {
  font-family: var(--font-display);
  font-size: 1rem;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
}

.home-card p {
  font-size: 0.75rem;
  color: var(--text2);
  margin-top: 4px;
}

.section-title {
  font-family: var(--font-display);
  font-size: 0.85rem;
  font-weight: 600;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text2);
  padding: 0 16px;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

.info-bar {
  margin: 0 16px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 14px 16px;
  display: flex;
  justify-content: space-around;
}

.info-item { text-align: center; }
.info-item .val {
  font-family: var(--font-display);
  font-size: 1.4rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--red), var(--blue-light));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.info-item .lbl { font-size: 0.7rem; color: var(--text2); margin-top: 2px; }

/* ===== CHANNEL LIST ===== */
.search-bar {
  padding: 14px 16px;
  position: sticky;
  top: 0;
  background: var(--bg);
  z-index: 10;
  border-bottom: 1px solid var(--border);
}

.search-input {
  width: 100%;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 11px 16px 11px 40px;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 0.9rem;
  outline: none;
  transition: border-color 0.2s;
  position: relative;
}

.search-bar { position: relative; }
.search-icon {
  position: absolute;
  left: 30px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text2);
  font-size: 1rem;
  pointer-events: none;
}

.search-input:focus { border-color: var(--blue-light); }

.category-scroll {
  display: flex;
  gap: 8px;
  padding: 10px 16px;
  overflow-x: auto;
  scrollbar-width: none;
  border-bottom: 1px solid var(--border);
}

.category-scroll::-webkit-scrollbar { display: none; }

.cat-btn {
  padding: 6px 14px;
  border-radius: 20px;
  border: 1px solid var(--border);
  background: var(--bg3);
  color: var(--text2);
  font-family: var(--font-body);
  font-size: 0.78rem;
  white-space: nowrap;
  cursor: pointer;
  transition: all 0.2s;
}

.cat-btn.active {
  background: var(--red);
  border-color: var(--red);
  color: #fff;
}

.channel-list {
  padding: 8px 0;
}

.channel-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 12px 16px;
  cursor: pointer;
  transition: background 0.15s;
  border-bottom: 1px solid var(--border);
}

.channel-item:hover, .channel-item:active { background: var(--bg3); }

.channel-logo {
  width: 52px;
  height: 38px;
  background: var(--bg4);
  border-radius: 8px;
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  flex-shrink: 0;
  overflow: hidden;
}

.channel-logo img { width: 100%; height: 100%; object-fit: contain; padding: 3px; }

.channel-info { flex: 1; min-width: 0; }
.channel-name {
  font-family: var(--font-body);
  font-size: 0.9rem;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.channel-epg { font-size: 0.72rem; color: var(--text2); margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.channel-num { font-size: 0.75rem; color: var(--text2); font-family: var(--font-display); }

.live-badge {
  background: var(--red);
  border-radius: 4px;
  padding: 2px 6px;
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 1px;
  flex-shrink: 0;
}

/* ===== MOVIE / SERIES GRID ===== */
.media-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
  gap: 12px;
  padding: 12px 16px;
}

.media-card {
  cursor: pointer;
  transition: transform 0.2s;
}

.media-card:hover { transform: scale(1.04); }
.media-card:active { transform: scale(0.96); }

.media-poster {
  aspect-ratio: 2/3;
  background: var(--bg4);
  border-radius: 10px;
  overflow: hidden;
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  margin-bottom: 6px;
  position: relative;
}

.media-poster img { width: 100%; height: 100%; object-fit: cover; }

.media-rating {
  position: absolute;
  bottom: 5px;
  right: 5px;
  background: rgba(0,0,0,0.75);
  border-radius: 4px;
  padding: 2px 5px;
  font-size: 0.65rem;
  color: #ffd700;
}

.media-title {
  font-size: 0.78rem;
  font-weight: 600;
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===== SETTINGS ===== */
.settings-content {
  padding: 16px;
}

.settings-section {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 16px;
}

.settings-label {
  padding: 10px 16px;
  font-size: 0.7rem;
  color: var(--text2);
  letter-spacing: 2px;
  text-transform: uppercase;
  border-bottom: 1px solid var(--border);
  background: rgba(255,255,255,0.02);
}

.settings-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.15s;
}

.settings-item:last-child { border-bottom: none; }
.settings-item:hover { background: rgba(255,255,255,0.03); }

.settings-item-left { display: flex; align-items: center; gap: 12px; }
.settings-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
.settings-icon.red { background: rgba(224,28,46,0.2); }
.settings-icon.blue { background: rgba(26,79,214,0.2); }
.settings-icon.gray { background: rgba(144,144,168,0.1); }

.settings-item-title { font-size: 0.9rem; font-weight: 500; }
.settings-item-sub { font-size: 0.75rem; color: var(--text2); margin-top: 1px; }
.settings-arrow { color: var(--text2); font-size: 0.8rem; }

.user-card {
  background: linear-gradient(135deg, rgba(224,28,46,0.15), rgba(26,79,214,0.15));
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 18px 16px;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 14px;
}

.user-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--red), var(--blue));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.4rem;
  flex-shrink: 0;
}

.user-info-name { font-family: var(--font-display); font-size: 1.1rem; font-weight: 700; }
.user-info-url { font-size: 0.72rem; color: var(--text2); margin-top: 2px; }
.user-expiry {
  margin-left: auto;
  text-align: right;
}
.user-expiry .exp-label { font-size: 0.65rem; color: var(--text2); text-transform: uppercase; letter-spacing: 1px; }
.user-expiry .exp-date { font-family: var(--font-display); font-size: 0.95rem; color: #4cff8f; margin-top: 2px; }

.btn-logout {
  width: 100%;
  padding: 12px;
  background: rgba(224,28,46,0.1);
  border: 1px solid rgba(224,28,46,0.3);
  border-radius: 10px;
  color: var(--red);
  font-family: var(--font-display);
  font-size: 0.95rem;
  font-weight: 600;
  letter-spacing: 2px;
  cursor: pointer;
  text-align: center;
  margin-top: 8px;
  transition: background 0.2s;
}

.btn-logout:hover { background: rgba(224,28,46,0.2); }

/* ===== PLAYER ===== */
#screen-player {
  background: #000;
  position: fixed;
  inset: 0;
  z-index: 1000;
  flex-direction: column;
  display: none;
}

#screen-player.active { display: flex; }

.player-video-container {
  flex: 1;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #000;
}

#player-video { width: 100%; height: 100%; object-fit: contain; }

.player-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, transparent 30%, transparent 60%, rgba(0,0,0,0.8) 100%);
  opacity: 0;
  transition: opacity 0.3s;
}

.player-overlay.visible { opacity: 1; }

.player-top {
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 14px;
}

.player-back {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
  border: none;
  color: #fff;
  font-size: 1.1rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.player-channel-name { font-family: var(--font-display); font-size: 1.1rem; font-weight: 600; }
.player-epg { font-size: 0.75rem; color: rgba(255,255,255,0.7); }

.player-bottom { padding: 16px; }

.player-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 24px;
  margin-top: 10px;
}

.player-btn {
  width: 46px;
  height: 46px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
  border: none;
  color: #fff;
  font-size: 1.2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
}

.player-btn:hover { background: rgba(255,255,255,0.25); }
.player-btn.play-btn { width: 58px; height: 58px; background: var(--red); font-size: 1.5rem; }

.player-loading {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.6);
}

.spinner {
  width: 48px;
  height: 48px;
  border: 3px solid rgba(255,255,255,0.2);
  border-top-color: var(--red);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

.player-loading p { margin-top: 14px; font-size: 0.85rem; color: rgba(255,255,255,0.7); }

/* ===== LOADING / SPLASH ===== */
#screen-loading {
  align-items: center;
  justify-content: center;
  background: var(--bg);
  position: fixed;
  inset: 0;
  z-index: 2000;
}

.splash-logo img {
  width: 120px;
  height: 120px;
  object-fit: contain;
  animation: splashScale 1s ease-out;
}

@keyframes splashScale {
  0% { transform: scale(0.5); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

.splash-logo h1 {
  font-family: var(--font-display);
  font-size: 3rem;
  font-weight: 700;
  letter-spacing: 6px;
  text-align: center;
  background: linear-gradient(135deg, var(--red), var(--blue-light));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-top: 10px;
  animation: splashFade 1s ease-out 0.3s both;
}

@keyframes splashFade {
  0% { opacity: 0; transform: translateY(10px); }
  100% { opacity: 1; transform: translateY(0); }
}

.splash-tagline {
  font-size: 0.75rem;
  color: var(--text2);
  letter-spacing: 4px;
  text-transform: uppercase;
  text-align: center;
  margin-top: 4px;
  animation: splashFade 1s ease-out 0.5s both;
}

.splash-bar {
  width: 180px;
  height: 3px;
  background: rgba(255,255,255,0.1);
  border-radius: 10px;
  margin-top: 40px;
  overflow: hidden;
  animation: splashFade 0.5s ease-out 0.6s both;
}

.splash-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--red), var(--blue-light));
  border-radius: 10px;
  animation: loadBar 1.8s ease-in-out 0.6s both;
}

@keyframes loadBar {
  0% { width: 0%; }
  100% { width: 100%; }
}

.tab-content { display: none; }
.tab-content.active { display: block; }

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text2);
}

.empty-state .empty-icon { font-size: 3rem; margin-bottom: 16px; }
.empty-state h3 { font-family: var(--font-display); font-size: 1.1rem; letter-spacing: 2px; margin-bottom: 8px; }
.empty-state p { font-size: 0.85rem; }

.reload-btn {
  padding: 10px 24px;
  background: var(--red);
  border: none;
  border-radius: 8px;
  color: #fff;
  font-family: var(--font-display);
  font-size: 0.9rem;
  font-weight: 600;
  letter-spacing: 2px;
  cursor: pointer;
  margin-top: 16px;
  transition: opacity 0.2s;
}

.reload-btn:hover { opacity: 0.85; }

/* Logo SVG inline */
.ativa-logo-svg {
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>
</head>
<body>

<!-- SPLASH -->
<div id="screen-loading" class="screen active">
  <div class="splash-logo">
    <div class="ativa-logo-svg" id="splash-logo-container">
      <!-- SVG logo inline -->
      <svg width="120" height="120" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
        <polygon points="100,20 185,165 15,165" fill="#e01c2e"/>
        <polygon points="100,60 160,165 65,165" fill="#0a0a0f"/>
        <path d="M70,140 Q100,80 145,110 Q120,130 70,140Z" fill="#1a4fd6"/>
        <path d="M65,155 Q110,100 155,125 Q130,145 65,155Z" fill="#1a4fd6"/>
        <path d="M60,168 Q115,118 158,140 Q135,158 60,168Z" fill="#1a4fd6"/>
      </svg>
    </div>
    <h1>ATIVATV</h1>
    <p class="splash-tagline">Entretenimento Sem Limites</p>
    <div class="splash-bar"><div class="splash-bar-fill"></div></div>
  </div>
</div>

<!-- LOGIN -->
<div id="screen-login" class="screen">
  <div class="login-bg"></div>
  <div class="login-grid"></div>
  <div class="login-card">
    <div class="login-logo">
      <div class="ativa-logo-svg">
        <svg width="90" height="90" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
          <polygon points="100,20 185,165 15,165" fill="#e01c2e"/>
          <polygon points="100,60 160,165 65,165" fill="#0a0a0f"/>
          <path d="M70,140 Q100,80 145,110 Q120,130 70,140Z" fill="#1a4fd6"/>
          <path d="M65,155 Q110,100 155,125 Q130,145 65,155Z" fill="#1a4fd6"/>
          <path d="M60,168 Q115,118 158,140 Q135,158 60,168Z" fill="#1a4fd6"/>
        </svg>
      </div>
      <h1>ATIVATV</h1>
      <p>Entretenimento Sem Limites</p>
    </div>
    <div class="login-form">
      <div class="form-group">
        <label>Usu√°rio</label>
        <input type="text" id="inp-user" placeholder="Digite seu usu√°rio" autocomplete="username">
      </div>
      <div class="form-group">
        <label>Senha</label>
        <input type="password" id="inp-pass" placeholder="Digite sua senha" autocomplete="current-password">
      </div>
      <div class="form-group">
        <label>URL do Servidor</label>
        <input type="url" id="inp-url" placeholder="http://servidor.com:8080" autocomplete="url">
      </div>
      <button class="btn-login" id="btn-login" onclick="doLogin()">ENTRAR</button>
      <div class="login-error" id="login-error"></div>
    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="screen-main" class="screen">
  <div class="header">
    <div class="header-logo">
      <svg width="36" height="36" viewBox="0 0 200 200" fill="none">
        <polygon points="100,20 185,165 15,165" fill="#e01c2e"/>
        <polygon points="100,60 160,165 65,165" fill="#0a0a0f"/>
        <path d="M70,140 Q100,80 145,110 Q120,130 70,140Z" fill="#1a4fd6"/>
        <path d="M65,155 Q110,100 155,125 Q130,145 65,155Z" fill="#1a4fd6"/>
        <path d="M60,168 Q115,118 158,140 Q135,158 60,168Z" fill="#1a4fd6"/>
      </svg>
      <span>ATIVATV</span>
    </div>
    <div class="header-actions">
      <div class="btn-icon" onclick="reloadData()" title="Recarregar">üîÑ</div>
    </div>
  </div>

  <div class="nav-tabs">
    <div class="nav-tab active" onclick="switchTab('home')">
      <span class="tab-icon">üè†</span>IN√çCIO
    </div>
    <div class="nav-tab" onclick="switchTab('tv')">
      <span class="tab-icon">üì∫</span>TV AO VIVO
    </div>
    <div class="nav-tab" onclick="switchTab('filmes')">
      <span class="tab-icon">üé¨</span>FILMES
    </div>
    <div class="nav-tab" onclick="switchTab('series')">
      <span class="tab-icon">üìΩÔ∏è</span>S√âRIES
    </div>
    <div class="nav-tab" onclick="switchTab('ajustes')">
      <span class="tab-icon">‚öôÔ∏è</span>AJUSTES
    </div>
  </div>

  <div class="content">
    <!-- HOME -->
    <div class="tab-content active" id="tab-home">
      <div class="home-hero">
        <div class="home-hero-bg"></div>
        <div class="home-hero-content">
          <h2>Bem-vindo! üëã</h2>
          <p id="hero-username">Carregando...</p>
        </div>
      </div>

      <div style="padding: 0 16px; margin-bottom: 20px;">
        <div class="info-bar">
          <div class="info-item">
            <div class="val" id="count-tv">-</div>
            <div class="lbl">Canais</div>
          </div>
          <div class="info-item">
            <div class="val" id="count-vod">-</div>
            <div class="lbl">Filmes</div>
          </div>
          <div class="info-item">
            <div class="val" id="count-series">-</div>
            <div class="lbl">S√©ries</div>
          </div>
        </div>
      </div>

      <div class="home-cards">
        <div class="home-card card-tv" onclick="switchTab('tv')">
          <span class="card-icon">üì∫</span>
          <h3>TV Ao Vivo</h3>
          <p>Canais em tempo real</p>
        </div>
        <div class="home-card card-filmes" onclick="switchTab('filmes')">
          <span class="card-icon">üé¨</span>
          <h3>Filmes</h3>
          <p>Cat√°logo completo</p>
        </div>
        <div class="home-card card-series" onclick="switchTab('series')">
          <span class="card-icon">üìΩÔ∏è</span>
          <h3>S√©ries</h3>
          <p>Temporadas e epis√≥dios</p>
        </div>
        <div class="home-card card-ajustes" onclick="switchTab('ajustes')">
          <span class="card-icon">‚öôÔ∏è</span>
          <h3>Ajustes</h3>
          <p>Configura√ß√µes</p>
        </div>
      </div>
    </div>

    <!-- TV AO VIVO -->
    <div class="tab-content" id="tab-tv">
      <div class="search-bar">
        <span class="search-icon">üîç</span>
        <input class="search-input" type="text" placeholder="Buscar canal..." id="search-tv" oninput="filterChannels(this.value)">
      </div>
      <div class="category-scroll" id="tv-categories"></div>
      <div class="channel-list" id="channel-list">
        <div class="empty-state">
          <div class="empty-icon">üì°</div>
          <h3>Carregando Canais</h3>
          <p>Aguarde um momento...</p>
        </div>
      </div>
    </div>

    <!-- FILMES -->
    <div class="tab-content" id="tab-filmes">
      <div class="search-bar">
        <span class="search-icon">üîç</span>
        <input class="search-input" type="text" placeholder="Buscar filme..." id="search-vod" oninput="filterVod(this.value)">
      </div>
      <div class="category-scroll" id="vod-categories"></div>
      <div class="media-grid" id="vod-grid">
        <div class="empty-state" style="grid-column: 1/-1;">
          <div class="empty-icon">üé¨</div>
          <h3>Carregando Filmes</h3>
          <p>Aguarde...</p>
        </div>
      </div>
    </div>

    <!-- S√âRIES -->
    <div class="tab-content" id="tab-series">
      <div class="search-bar">
        <span class="search-icon">üîç</span>
        <input class="search-input" type="text" placeholder="Buscar s√©rie..." id="search-series" oninput="filterSeries(this.value)">
      </div>
      <div class="category-scroll" id="series-categories"></div>
      <div class="media-grid" id="series-grid">
        <div class="empty-state" style="grid-column: 1/-1;">
          <div class="empty-icon">üìΩÔ∏è</div>
          <h3>Carregando S√©ries</h3>
          <p>Aguarde...</p>
        </div>
      </div>
    </div>

    <!-- AJUSTES -->
    <div class="tab-content" id="tab-ajustes">
      <div class="settings-content">
        <div class="user-card">
          <div class="user-avatar">üë§</div>
          <div>
            <div class="user-info-name" id="settings-username">-</div>
            <div class="user-info-url" id="settings-url">-</div>
          </div>
          <div class="user-expiry">
            <div class="exp-label">Vencimento</div>
            <div class="exp-date" id="settings-expiry">-</div>
          </div>
        </div>

        <div class="settings-section">
          <div class="settings-label">Conta</div>
          <div class="settings-item">
            <div class="settings-item-left">
              <div class="settings-icon blue">üë§</div>
              <div>
                <div class="settings-item-title">Usu√°rio</div>
                <div class="settings-item-sub" id="info-user">-</div>
              </div>
            </div>
          </div>
          <div class="settings-item">
            <div class="settings-item-left">
              <div class="settings-icon blue">üåê</div>
              <div>
                <div class="settings-item-title">Servidor</div>
                <div class="settings-item-sub" id="info-server">-</div>
              </div>
            </div>
          </div>
          <div class="settings-item">
            <div class="settings-item-left">
              <div class="settings-icon blue">üîó</div>
              <div>
                <div class="settings-item-title">Conex√µes</div>
                <div class="settings-item-sub" id="info-conn">-</div>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-section">
          <div class="settings-label">Aplicativo</div>
          <div class="settings-item" onclick="reloadData()">
            <div class="settings-item-left">
              <div class="settings-icon gray">üîÑ</div>
              <div>
                <div class="settings-item-title">Recarregar Listas</div>
                <div class="settings-item-sub">Atualizar canais, filmes e s√©ries</div>
              </div>
            </div>
            <span class="settings-arrow">‚Ä∫</span>
          </div>
          <div class="settings-item">
            <div class="settings-item-left">
              <div class="settings-icon gray">‚ÑπÔ∏è</div>
              <div>
                <div class="settings-item-title">Vers√£o</div>
                <div class="settings-item-sub">AtivaTV v1.0.0</div>
              </div>
            </div>
          </div>
        </div>

        <button class="btn-logout" onclick="doLogout()">üö™ SAIR DA CONTA</button>
      </div>
    </div>
  </div>
</div>

<!-- PLAYER -->
<div id="screen-player">
  <div class="player-video-container" onclick="togglePlayerOverlay()">
    <video id="player-video" playsinline></video>
    <div class="player-loading" id="player-loading">
      <div class="spinner"></div>
      <p id="player-loading-text">Carregando stream...</p>
    </div>
    <div class="player-overlay" id="player-overlay">
      <div class="player-top">
        <button class="player-back" onclick="closePlayer(event)">‚Äπ</button>
        <div>
          <div class="player-channel-name" id="player-title">-</div>
          <div class="player-epg" id="player-epg">Ao Vivo</div>
        </div>
        <div style="margin-left:auto; background:var(--red); border-radius:4px; padding:3px 8px; font-size:0.65rem; font-weight:700; letter-spacing:1px;">AO VIVO</div>
      </div>
      <div class="player-bottom">
        <div class="player-controls">
          <button class="player-btn" onclick="restartStream()" title="Reiniciar">‚Ü∫</button>
          <button class="player-btn play-btn" id="play-pause-btn" onclick="togglePlay(event)">‚è∏</button>
          <button class="player-btn" onclick="toggleFullscreen()" title="Tela cheia">‚õ∂</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ===== STATE =====
let state = {
  user: '', pass: '', url: '',
  userInfo: null,
  channels: [], vodList: [], seriesList: [],
  channelCats: [], vodCats: [], seriesCats: [],
  currentChannelCat: 'all',
  currentVodCat: 'all',
  currentSeriesCat: 'all',
  currentStream: null
};

let hls = null;
let playerOverlayTimeout = null;

// ===== LOGO SVG =====
const LOGO_SVG = `<svg width="36" height="36" viewBox="0 0 200 200" fill="none"><polygon points="100,20 185,165 15,165" fill="#e01c2e"/><polygon points="100,60 160,165 65,165" fill="#0a0a0f"/><path d="M70,140 Q100,80 145,110 Q120,130 70,140Z" fill="#1a4fd6"/><path d="M65,155 Q110,100 155,125 Q130,145 65,155Z" fill="#1a4fd6"/><path d="M60,168 Q115,118 158,140 Q135,158 60,168Z" fill="#1a4fd6"/></svg>`;

// ===== INIT =====
window.addEventListener('load', () => {
  setTimeout(() => {
    document.getElementById('screen-loading').style.display = 'none';
    const saved = localStorage.getItem('ativatv_session');
    if (saved) {
      const s = JSON.parse(saved);
      state.user = s.user; state.pass = s.pass; state.url = s.url;
      showMain();
      loadAllData();
    } else {
      showScreen('login');
    }
  }, 2400);
});

function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  const el = document.getElementById('screen-' + name);
  if (el) el.classList.add('active');
}

function showMain() {
  showScreen('main');
  updateSettingsUI();
}

// ===== LOGIN =====
async function doLogin() {
  const user = document.getElementById('inp-user').value.trim();
  const pass = document.getElementById('inp-pass').value.trim();
  let url = document.getElementById('inp-url').value.trim();
  const errEl = document.getElementById('login-error');
  errEl.style.display = 'none';

  if (!user || !pass || !url) {
    showError('Preencha todos os campos.');
    return;
  }

  if (!url.startsWith('http')) url = 'http://' + url;
  url = url.replace(/\/$/, '');

  const btn = document.getElementById('btn-login');
  btn.textContent = 'VERIFICANDO...';
  btn.disabled = true;

  try {
    const apiUrl = `${url}/player_api.php?username=${user}&password=${pass}`;
    const res = await fetch(apiUrl);
    const data = await res.json();

    if (data.user_info && data.user_info.auth == 1) {
      state.user = user; state.pass = pass; state.url = url;
      state.userInfo = data.user_info;
      localStorage.setItem('ativatv_session', JSON.stringify({user, pass, url}));
      showMain();
      loadAllData();
    } else {
      showError('Usu√°rio, senha ou servidor inv√°lido.');
    }
  } catch(e) {
    showError('N√£o foi poss√≠vel conectar ao servidor. Verifique a URL.');
  }

  btn.textContent = 'ENTRAR';
  btn.disabled = false;
}

function showError(msg) {
  const el = document.getElementById('login-error');
  el.textContent = msg;
  el.style.display = 'block';
}

document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && document.getElementById('screen-login').classList.contains('active')) doLogin();
});

// ===== LOAD DATA =====
async function loadAllData() {
  loadUserInfo();
  loadChannels();
  loadVod();
  loadSeries();
}

async function loadUserInfo() {
  if (state.userInfo) { updateSettingsUI(); return; }
  try {
    const res = await fetch(`${state.url}/player_api.php?username=${state.user}&password=${state.pass}`);
    const data = await res.json();
    if (data.user_info) { state.userInfo = data.user_info; updateSettingsUI(); }
  } catch(e) {}
}

function updateSettingsUI() {
  const ui = state.userInfo;
  document.getElementById('hero-username').textContent = ui ? `Usu√°rio: ${state.user}` : `Usu√°rio: ${state.user}`;
  document.getElementById('settings-username').textContent = state.user;
  document.getElementById('settings-url').textContent = state.url;
  document.getElementById('info-user').textContent = state.user;
  document.getElementById('info-server').textContent = state.url;

  if (ui) {
    const exp = ui.exp_date ? new Date(ui.exp_date * 1000).toLocaleDateString('pt-BR') : 'Ilimitado';
    document.getElementById('settings-expiry').textContent = exp;
    document.getElementById('info-conn').textContent = `${ui.active_cons || 0} / ${ui.max_connections || 1} ativas`;
  }
}

async function loadChannels() {
  try {
    const [catsRes, chRes] = await Promise.all([
      fetch(`${state.url}/player_api.php?username=${state.user}&password=${state.pass}&action=get_live_categories`),
      fetch(`${state.url}/player_api.php?username=${state.user}&password=${state.pass}&action=get_live_streams`)
    ]);
    const cats = await catsRes.json();
    const channels = await chRes.json();
    state.channelCats = Array.isArray(cats) ? cats : [];
    state.channels = Array.isArray(channels) ? channels : [];
    document.getElementById('count-tv').textContent = state.channels.length.toLocaleString();
    renderChannelCategories();
    renderChannels(state.channels);
  } catch(e) {
    document.getElementById('channel-list').innerHTML = errorState('canais', 'tv');
  }
}

async function loadVod() {
  try {
    const [catsRes, vodRes] = await Promise.all([
      fetch(`${state.url}/player_api.php?username=${state.user}&password=${state.pass}&action=get_vod_categories`),
      fetch(`${state.url}/player_api.php?username=${state.user}&password=${state.pass}&action=get_vod_streams`)
    ]);
    const cats = await catsRes.json();
    const vod = await vodRes.json();
    state.vodCats = Array.isArray(cats) ? cats : [];
    state.vodList = Array.isArray(vod) ? vod : [];
    document.getElementById('count-vod').textContent = state.vodList.length.toLocaleString();
    renderVodCategories();
    renderVod(state.vodList.slice(0, 100));
  } catch(e) {
    document.getElementById('vod-grid').innerHTML = errorState('filmes', 'filmes');
  }
}

async function loadSeries() {
  try {
    const [catsRes, serRes] = await Promise.all([
      fetch(`${state.url}/player_api.php?username=${state.user}&password=${state.pass}&action=get_series_categories`),
      fetch(`${state.url}/player_api.php?username=${state.user}&password=${state.pass}&action=get_series`)
    ]);
    const cats = await catsRes.json();
    const series = await serRes.json();
    state.seriesCats = Array.isArray(cats) ? cats : [];
    state.seriesList = Array.isArray(series) ? series : [];
    document.getElementById('count-series').textContent = state.seriesList.length.toLocaleString();
    renderSeriesCategories();
    renderSeries(state.seriesList.slice(0, 100));
  } catch(e) {
    document.getElementById('series-grid').innerHTML = errorState('s√©ries', 'series');
  }
}

function errorState(tipo, tab) {
  return `<div class="empty-state" style="grid-column:1/-1;"><div class="empty-icon">‚ö†Ô∏è</div><h3>Erro ao Carregar ${tipo}</h3><p>Verifique sua conex√£o</p><button class="reload-btn" onclick="switchTab('${tab}')">Tentar Novamente</button></div>`;
}

// ===== RENDER CHANNELS =====
function renderChannelCategories() {
  const el = document.getElementById('tv-categories');
  let html = `<div class="cat-btn active" onclick="filterChannelCat('all', this)">Todos</div>`;
  state.channelCats.forEach(c => {
    html += `<div class="cat-btn" onclick="filterChannelCat('${c.category_id}', this)">${c.category_name}</div>`;
  });
  el.innerHTML = html;
}

function filterChannelCat(catId, el) {
  state.currentChannelCat = catId;
  document.querySelectorAll('#tv-categories .cat-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  const filtered = catId === 'all' ? state.channels : state.channels.filter(c => c.category_id == catId);
  renderChannels(filtered);
}

function renderChannels(channels) {
  const el = document.getElementById('channel-list');
  if (!channels.length) { el.innerHTML = `<div class="empty-state"><div class="empty-icon">üì°</div><h3>Nenhum canal encontrado</h3></div>`; return; }
  el.innerHTML = channels.slice(0, 200).map((ch, i) => `
    <div class="channel-item" onclick="playChannel(${JSON.stringify(ch).replace(/"/g,'&quot;')})">
      <div class="channel-logo">
        ${ch.stream_icon ? `<img src="${ch.stream_icon}" onerror="this.parentElement.innerHTML='üì∫'" loading="lazy">` : 'üì∫'}
      </div>
      <div class="channel-info">
        <div class="channel-name">${ch.name || 'Canal ' + (i+1)}</div>
        <div class="channel-epg">${ch.epg_channel_id || 'Ao Vivo'}</div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;">
        <span class="live-badge">AO VIVO</span>
        <span class="channel-num">#${ch.num || i+1}</span>
      </div>
    </div>
  `).join('');
}

function filterChannels(q) {
  const cat = state.currentChannelCat;
  let filtered = cat === 'all' ? state.channels : state.channels.filter(c => c.category_id == cat);
  if (q) filtered = filtered.filter(c => c.name && c.name.toLowerCase().includes(q.toLowerCase()));
  renderChannels(filtered);
}

// ===== RENDER VOD =====
function renderVodCategories() {
  const el = document.getElementById('vod-categories');
  let html = `<div class="cat-btn active" onclick="filterVodCat('all', this)">Todos</div>`;
  state.vodCats.forEach(c => { html += `<div class="cat-btn" onclick="filterVodCat('${c.category_id}', this)">${c.category_name}</div>`; });
  el.innerHTML = html;
}

function filterVodCat(catId, el) {
  state.currentVodCat = catId;
  document.querySelectorAll('#vod-categories .cat-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  const filtered = catId === 'all' ? state.vodList : state.vodList.filter(v => v.category_id == catId);
  renderVod(filtered.slice(0, 100));
}

function renderVod(list) {
  const el = document.getElementById('vod-grid');
  if (!list.length) { el.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üé¨</div><h3>Nenhum filme encontrado</h3></div>`; return; }
  el.innerHTML = list.map(v => `
    <div class="media-card" onclick="playVod(${v.stream_id}, '${(v.name||'').replace(/'/g,"\\'")}', '${v.stream_icon||''}')">
      <div class="media-poster">
        ${v.stream_icon ? `<img src="${v.stream_icon}" onerror="this.parentElement.innerHTML='üé¨'" loading="lazy">` : 'üé¨'}
        ${v.rating ? `<span class="media-rating">‚≠ê ${parseFloat(v.rating).toFixed(1)}</span>` : ''}
      </div>
      <div class="media-title">${v.name || 'Filme'}</div>
    </div>
  `).join('');
}

function filterVod(q) {
  const cat = state.currentVodCat;
  let filtered = cat === 'all' ? state.vodList : state.vodList.filter(v => v.category_id == cat);
  if (q) filtered = filtered.filter(v => v.name && v.name.toLowerCase().includes(q.toLowerCase()));
  renderVod(filtered.slice(0, 100));
}

// ===== RENDER SERIES =====
function renderSeriesCategories() {
  const el = document.getElementById('series-categories');
  let html = `<div class="cat-btn active" onclick="filterSeriesCat('all', this)">Todos</div>`;
  state.seriesCats.forEach(c => { html += `<div class="cat-btn" onclick="filterSeriesCat('${c.category_id}', this)">${c.category_name}</div>`; });
  el.innerHTML = html;
}

function filterSeriesCat(catId, el) {
  state.currentSeriesCat = catId;
  document.querySelectorAll('#series-categories .cat-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  const filtered = catId === 'all' ? state.seriesList : state.seriesList.filter(s => s.category_id == catId);
  renderSeries(filtered.slice(0, 100));
}

function renderSeries(list) {
  const el = document.getElementById('series-grid');
  if (!list.length) { el.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><div class="empty-icon">üìΩÔ∏è</div><h3>Nenhuma s√©rie encontrada</h3></div>`; return; }
  el.innerHTML = list.map(s => `
    <div class="media-card">
      <div class="media-poster">
        ${s.cover ? `<img src="${s.cover}" onerror="this.parentElement.innerHTML='üìΩÔ∏è'" loading="lazy">` : 'üìΩÔ∏è'}
        ${s.rating ? `<span class="media-rating">‚≠ê ${parseFloat(s.rating).toFixed(1)}</span>` : ''}
      </div>
      <div class="media-title">${s.name || 'S√©rie'}</div>
    </div>
  `).join('');
}

function filterSeries(q) {
  const cat = state.currentSeriesCat;
  let filtered = cat === 'all' ? state.seriesList : state.seriesList.filter(s => s.category_id == cat);
  if (q) filtered = filtered.filter(s => s.name && s.name.toLowerCase().includes(q.toLowerCase()));
  renderSeries(filtered.slice(0, 100));
}

// ===== PLAYER =====
function playChannel(ch) {
  const ext = 'ts';
  const streamUrl = `${state.url}/live/${state.user}/${state.pass}/${ch.stream_id}.${ext}`;
  document.getElementById('player-title').textContent = ch.name || 'Canal';
  document.getElementById('player-epg').textContent = 'Ao Vivo';
  openPlayer(streamUrl);
}

function playVod(id, name, cover) {
  const streamUrl = `${state.url}/movie/${state.user}/${state.pass}/${id}.mp4`;
  document.getElementById('player-title').textContent = name || 'Filme';
  document.getElementById('player-epg').textContent = 'Filme';
  openPlayer(streamUrl);
}

function openPlayer(url) {
  state.currentStream = url;
  document.getElementById('screen-player').style.display = 'flex';
  document.getElementById('player-loading').style.display = 'flex';
  document.getElementById('player-loading-text').textContent = 'Carregando stream...';

  const video = document.getElementById('player-video');

  if (hls) { hls.destroy(); hls = null; }

  if (Hls.isSupported()) {
    hls = new Hls({ enableWorker: true, lowLatencyMode: true });
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.play();
      document.getElementById('player-loading').style.display = 'none';
    });
    hls.on(Hls.Events.ERROR, (e, data) => {
      if (data.fatal) {
        document.getElementById('player-loading-text').textContent = 'Erro ao carregar. Tente outro canal.';
      }
    });
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = url;
    video.addEventListener('loadeddata', () => {
      document.getElementById('player-loading').style.display = 'none';
    });
    video.play();
  } else {
    video.src = url;
    video.play().then(() => {
      document.getElementById('player-loading').style.display = 'none';
    }).catch(() => {
      document.getElementById('player-loading-text').textContent = 'Erro ao carregar stream.';
    });
  }

  showPlayerOverlay();
}

function closePlayer(e) {
  if (e) e.stopPropagation();
  if (hls) { hls.destroy(); hls = null; }
  const video = document.getElementById('player-video');
  video.pause();
  video.src = '';
  document.getElementById('screen-player').style.display = 'none';
}

function togglePlayerOverlay() {
  const overlay = document.getElementById('player-overlay');
  if (overlay.classList.contains('visible')) {
    overlay.classList.remove('visible');
  } else {
    showPlayerOverlay();
  }
}

function showPlayerOverlay() {
  const overlay = document.getElementById('player-overlay');
  overlay.classList.add('visible');
  clearTimeout(playerOverlayTimeout);
  playerOverlayTimeout = setTimeout(() => overlay.classList.remove('visible'), 4000);
}

function togglePlay(e) {
  e.stopPropagation();
  const video = document.getElementById('player-video');
  const btn = document.getElementById('play-pause-btn');
  if (video.paused) { video.play(); btn.textContent = '‚è∏'; }
  else { video.pause(); btn.textContent = '‚ñ∂'; }
  showPlayerOverlay();
}

function restartStream() {
  if (state.currentStream) openPlayer(state.currentStream);
}

function toggleFullscreen() {
  const el = document.getElementById('screen-player');
  if (!document.fullscreenElement) {
    el.requestFullscreen && el.requestFullscreen();
  } else {
    document.exitFullscreen && document.exitFullscreen();
  }
}

// ===== NAV =====
function switchTab(tab) {
  document.querySelectorAll('.nav-tab').forEach((t, i) => {
    const tabs = ['home','tv','filmes','series','ajustes'];
    t.classList.toggle('active', tabs[i] === tab);
  });
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
}

// ===== MISC =====
function reloadData() {
  state.channels = []; state.vodList = []; state.seriesList = [];
  loadAllData();
}

function doLogout() {
  if (confirm('Deseja sair da conta?')) {
    localStorage.removeItem('ativatv_session');
    state = { user:'', pass:'', url:'', userInfo:null, channels:[], vodList:[], seriesList:[], channelCats:[], vodCats:[], seriesCats:[], currentChannelCat:'all', currentVodCat:'all', currentSeriesCat:'all', currentStream:null };
    showScreen('login');
    document.getElementById('inp-user').value = '';
    document.getElementById('inp-pass').value = '';
    document.getElementById('inp-url').value = '';
  }
}

// Back button support
window.addEventListener('popstate', () => {
  if (document.getElementById('screen-player').style.display === 'flex') closePlayer();
});
</script>
</body>
</html>
